<idea-plugin>
    <id>lsfusion.idea.plugin</id>
    <name>lsFusion support</name>
    <version>1.0.133</version>
    <vendor email="luxsoft@adsl.by" url="http://luxsoft.by">Luxsoft</vendor>

    <description><![CDATA[
      Plugin adds editing and navigation support for lsFusion scripting files (*.lsf)
      ]]></description>

    <change-notes><![CDATA[
        <b>Version 1.0.134</b><br>
        <ul>
            <li>FIELDS..DO clause in IMPORT operator</li>
            <li>HEADERS fix</li>
        </ul>
    ]]>
    </change-notes>

    <!-- please see http://confluence.jetbrains.net/display/IDEADEV/Build+Number+Ranges for description -->
    <idea-version since-build="171.3780.107"/>

    <!-- please see http://confluence.jetbrains.net/display/IDEADEV/Plugin+Compatibility+with+IntelliJ+Platform+Products
         on how to target different products -->
    <depends>com.intellij.properties</depends>
    <depends>AntSupport</depends>

    <application-components>
        <!-- Add your application components here -->
        <component>
            <implementation-class>com.lsfusion.LSFApplicationComponent</implementation-class>
        </component>
    </application-components>

    <project-components>
        <!-- Add your project components here -->
        <component>
            <implementation-class>com.lsfusion.lang.meta.MetaChangeDetector</implementation-class>
            <skipForDefaultProject/>
        </component>

        <component>
            <implementation-class>com.lsfusion.design.FormDesignChangeDetector</implementation-class>
            <skipForDefaultProject/>
        </component>

        <component>
            <implementation-class>com.lsfusion.LSFBaseProjectComponent</implementation-class>
            <skipForDefaultProject/>
        </component>

    </project-components>

    <actions>
        <group id="LSFGroup" popup="true" text="_LSF">
            <add-to-group group-id="MainMenu" anchor="after" relative-to-action="CodeMenu"/>
        
            <action id="MetaCode.Enable" class="com.lsfusion.actions.MetaCodeEnableAction" text="Toggle _meta"
                    description="Toggle meta code mode">
                <keyboard-shortcut first-keystroke="control alt shift M" keymap="$default"/>
            </action>
            <action id="MetaCode.Refresh" class="com.lsfusion.actions.MetaRefreshAction" text="Refresh _meta"
                    description="Refresh meta code"/>
            <action id="MetaCode.Reenable" class="com.lsfusion.actions.MetaReenableAction" text="Reenable _meta"
                    description="Enable disabled meta code blocks"/>
            <action id="MetaCode.ShowFile" class="com.lsfusion.actions.MetaShowFileAction" text="Show _meta for file"
                    description="Show meta code for current file">
                <keyboard-shortcut first-keystroke="control alt K" keymap="$default"/>
            </action>
            <action id="MetaCode.HideFile" class="com.lsfusion.actions.MetaHideFileAction" text="Hide _meta for file"
                    description="Hide meta code for current file">
                <keyboard-shortcut first-keystroke="control alt shift K" keymap="$default"/>
            </action>
            <action id="MetaCode.SyncMode" class="com.lsfusion.actions.MetaSyncModeAction" text="Meta sync mode"
                    description="Toggle meta code sync mode"/>
            
            <separator/>
            <action id="ToggleLSFCompletion" class="com.lsfusion.actions.ToggleCompletionAction"
                    text="lsFusion completion support"
                    description="Toggle lsFusion completion support"/>
            <action id="ToggleLSFComplexity" class="com.lsfusion.actions.ToggleComplexityAction"
                    text="Show property complexity" description="Toggle property complexity"/>
            <action id="ToggleLSFShowTable" class="com.lsfusion.actions.ToggleShowTableAction"
                    text="Show property table" description="Toggle showing property table"/>
            
            <group id="propertyFolding" popup="true" text="Property classes">
                <action id="AllPropertyFolding" class="com.lsfusion.actions.folding.ShowAllPropertyFoldingAction"
                        text="All" description="Show classes for all properties"/>
                <action id="NonePropertyFolding" class="com.lsfusion.actions.folding.ShowNonePropertyFoldingAction"
                        text="None" description="Don't show classes for properties"/>
                <action id="ImplicitPropertyFolding" class="com.lsfusion.actions.folding.ShowImplicitPropertyFoldingAction"
                        text="Implicit" description="Show implicit classes only"/>
            </group>
            
            <action id="Errors" class="com.lsfusion.actions.ShowErrorsAction" text="Show errors"
                    description="Show all current errors in all files">
                <keyboard-shortcut first-keystroke="control alt shift E" keymap="$default"/>
            </action>

            <separator/>
            
            <action id="TypeInfer.File" class="com.lsfusion.lang.typeinfer.FileTypeInferAction" text="Infer _types for file"
                    description="Infer types for file">
                <keyboard-shortcut first-keystroke="control alt shift I" keymap="$default"/>
            </action>
            <action id="TypeInfer.Project" class="com.lsfusion.actions.ProjectTypeInferAction"
                    text="Infer _types for project" description="Infer types for project">
                <keyboard-shortcut first-keystroke="control alt shift P" keymap="$default"/>
            </action>
            <action id="Check.Abstract" class="com.lsfusion.actions.ProjectCheckAbstractAction"
                    text="Check abstract for project" description="Check abstract for project"/>
            <action id="TypeInfer.Check" class="com.lsfusion.lang.typeinfer.FindNotInferredAction" text="Find not inferred"
                    description="Find not inferred elements for project"/>
            <action id="InsertComposition" class="com.lsfusion.actions.InsertCompositionAction">
                <keyboard-shortcut first-keystroke="control alt shift W" keymap="$default"/>
            </action>
            <action id="FastInsertComposition" class="com.lsfusion.actions.FastInsertCompositionAction">
                <keyboard-shortcut first-keystroke="control alt W" keymap="$default"/>
            </action>
            <action id="Project.Shorten" class="com.lsfusion.actions.ProjectShortenNamesAction"
                    text="Shorten names for project" description="Shorten names for project">
                <keyboard-shortcut first-keystroke="control alt shift U" keymap="$default"/>
            </action>
            <action id="Project.InferShorten" class="com.lsfusion.actions.ProjectInferShortenAction"
                    text="Infer types and shorten names for project"
                    description="Infer types and shorten names for project"/>
            <action id="Project.UnqualifyRefs" class="com.lsfusion.actions.ProjectUnqualifyRefsAction"
                    text="Unqualify refs for project" description="Unqualify refs for project"/>
            <action id="File.UnqualifyRefs" class="com.lsfusion.actions.FileUnqualifyRefsAction"
                    text="Unqualify refs for file" description="Unqualify refs for file"/>
            <!--<action id="Project.RenameFields" class="com.lsfusion.actions.RenameJrxmlFieldsToNewFormat" text="Rename jrxml fields" description="Rename jrxml fields to new format"/>-->
        </group>
        
        <action id="NewLsfFile" class="com.lsfusion.module.NewLsfFileAction">
            <add-to-group group-id="NewGroup" anchor="first"/>
        </action>
        
        <action id="PreFindUsagesAction" class="com.lsfusion.actions.PreShowPropertyUsagesAction">
            <keyboard-shortcut first-keystroke="ctrl alt F7" keymap="$default"/>
        </action>
        <action id="PreFastFindUsagesAction" class="com.lsfusion.actions.PreFindPropertyUsagesAction">
            <keyboard-shortcut first-keystroke="alt F7" keymap="$default"/>
        </action>
    </actions>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Add your extensions here -->
        <fileTypeFactory implementation="com.lsfusion.lang.LSFFileTypeFactory"/>
        <lang.parserDefinition language="Lsf" implementationClass="com.lsfusion.lang.LSFParserDefinition"/>

        <fileStructureGroupRuleProvider implementation="com.lsfusion.usage.LSFStatementGroupingRuleProvider"/>
        <lang.findUsagesProvider language="Lsf" implementationClass="com.lsfusion.usage.LSFFindUsagesProvider"/>
        <usageTypeProvider implementation="com.lsfusion.usage.LSFUsageTypeProvider"/>
        <usageFilteringRuleProvider implementation="com.lsfusion.usage.LSFUsageFilteringRuleProvider"/>
        <findUsagesHandlerFactory implementation="com.lsfusion.usage.LSFFindUsagesHandlerFactory"/>
        <actionPromoter implementation="com.lsfusion.actions.LSFActionPromoter"/>

        <callHierarchyProvider language="Lsf"
                               implementationClass="com.lsfusion.hierarchy.usages.LSFUsageHierarchyProvider"/>
        <typeHierarchyProvider language="Lsf"
                               implementationClass="com.lsfusion.hierarchy.classes.LSFClassHierarchyProvider"/>

        <multiHostInjector implementation="com.lsfusion.references.LSFToJavaLanguageInjector"/>
        <multiHostInjector implementation="com.lsfusion.references.LSFToJrxmlLanguageInjector"/>
        <!--<psi.referenceContributor implementation="com.lsfusion.references.FormJavaReferenceContributor"/>-->
        <lang.syntaxHighlighterFactory language="Lsf"
                                       implementationClass="com.lsfusion.lang.highlight.LSFSyntaxHighlighterFactory"/>
        <lang.braceMatcher language="Lsf" implementationClass="com.lsfusion.lang.LSFBraceMatcher"/>
        <lang.commenter language="Lsf" implementationClass="com.lsfusion.lang.LSFCommenter"/>
        <lang.foldingBuilder language="Lsf" implementationClass="com.lsfusion.lang.folding.LSFFoldingBuilder"/>
        <annotator language="Lsf" implementationClass="com.lsfusion.lang.LSFReferenceAnnotator"/>
        <annotator language="JAVA" implementationClass="com.lsfusion.references.FromJavaReferenceAnnotator"/>
        <readWriteAccessDetector implementation="com.lsfusion.LSFReadWriteAccessDetector"/>
        <definitionsSearch implementation="com.lsfusion.ImplementationsSearch"/>
        <gotoTargetRendererProvider implementation="com.lsfusion.LSFGoToTargetRendererProvider"/>
        <structureViewBuilder factoryClass="com.lsfusion.structure.LSFInterfacesStructureViewBuilderFactory"/>

        <fileEditorProvider implementation="com.lsfusion.design.LSFDesignEditorProvider"/>
        <codeInsight.lineMarkerProvider language="Lsf"
                                        implementationClass="com.lsfusion.design.DesignPreviewLineMarkerProvider"/>

        <codeInsight.lineMarkerProvider language="Lsf"
                                        implementationClass="com.lsfusion.lang.meta.MetaNestingLineMarkerProvider"/>

        <codeInsight.gotoSuper language="Lsf" implementationClass="com.lsfusion.actions.LSFGoToSuperHandler"/>

        <lang.refactoringSupport language="Lsf" implementationClass="com.lsfusion.refactoring.LSFRefactoringSupportProvider"/>

        <renamePsiElementProcessor implementation="com.lsfusion.refactoring.LSFRenameFullNameProcessor"/>

        <refactoring.safeDeleteProcessor implementation="com.lsfusion.refactoring.LSFSafeDeleteProcessor"/>
        
        <elementDescriptionProvider implementation="com.lsfusion.lang.psi.LSFElementDescriptionProvider"/>

        <completion.contributor language="Lsf" implementationClass="com.lsfusion.completion.ASTCompletionContributor"/>

        <localInspection groupPath="Lsf" language="Lsf" shortName="LSFUnused" displayName="LSF Unused element"
                         groupKey="lsf.warnings" groupBundle="com.lsfusion.LSFBundle" enabledByDefault="false" level="WARNING"
                         implementationClass="com.lsfusion.inspections.LSFUnusedInspectionTool" hasStaticDescription="true"/>

        <localInspection groupPath="Lsf" language="Lsf" shortName="LSFUnusedInMeta" displayName="LSF Unused element in metacode"
                         groupKey="lsf.warnings" groupBundle="com.lsfusion.LSFBundle" enabledByDefault="false" level="WARNING"
                         implementationClass="com.lsfusion.inspections.LSFUnusedInMetaInspectionTool" hasStaticDescription="true"/>

        <localInspection groupPath="Lsf" language="Lsf" shortName="LSFTypeMismatch" displayName="LSF Type mismatch"
                         groupKey="lsf.warnings" groupBundle="com.lsfusion.LSFBundle" enabledByDefault="true" level="WARNING"
                         implementationClass="com.lsfusion.inspections.LSFTypeMismatchInspectionTool" hasStaticDescription="true"/>

        <localInspection groupPath="Lsf" language="Lsf" shortName="LSFClassViewTypeInPrint" displayName="LSF ClassViewType in PRINT"
                         groupKey="lsf.warnings" groupBundle="com.lsfusion.LSFBundle" enabledByDefault="true" level="WARNING"
                         implementationClass="com.lsfusion.inspections.LSFClassViewTypeInPrintInspectionTool" hasStaticDescription="true"/>

        <internalFileTemplate name="lsFusion script"/>
        <internalFileTemplate name="lsFusion settings"/>

        <moduleBuilder builderClass="com.lsfusion.module.LSFusionModuleBuilder"/>
        <library.presentationProvider implementation="com.lsfusion.module.LSFusionLibraryPresentationProvider"/>
        <configurationType implementation="com.lsfusion.module.run.LSFusionRunConfigurationType"/>

        <stubIndex implementation="com.lsfusion.lang.psi.indexes.MetaIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ModuleIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.PropIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ActionIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ClassIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ExplicitNamespaceIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.FormIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.GroupIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.TableIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.WindowIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.NavigatorElementIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ComponentIndex"/>

        <stubIndex implementation="com.lsfusion.lang.psi.indexes.TableClassesIndex"/>

        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ExtendFormIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ExtendClassIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.DesignIndex"/>

        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ClassExtendsClassIndex"/>

        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ExplicitInterfacePropIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ExplicitValueIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ImplicitValueIndex"/>
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ImplicitInterfacePropIndex"/>
        
        <stubIndex implementation="com.lsfusion.lang.psi.indexes.ExplicitInterfaceActionIndex"/>

        <!-- caches -->
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ParamClassesCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ParamClassesCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ValueClassCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ValueClassCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.TableNameCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.TableNameCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ColumnNameCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ColumnNameCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ColumnNamingPolicyCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ColumnNamingPolicyCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.PropertyDependenciesCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.PropertyDependenciesCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.PropertyDependentsCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.PropertyDependentsCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.RequireModulesCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.RequireModulesCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ModuleDependentsCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ModuleDependentsCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.PropertyComplexityCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.PropertyComplexityCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ParentsCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ParentsCache"/>
        <projectService serviceInterface="com.lsfusion.lang.psi.cache.ChildrenCache"
                        serviceImplementation="com.lsfusion.lang.psi.cache.ChildrenCache"/>

        <stubElementTypeHolder class="com.lsfusion.lang.psi.LSFTypes"/>
        <gotoClassContributor implementation="com.lsfusion.LSFClassContributor"/>
        <gotoSymbolContributor implementation="com.lsfusion.LSFSymbolContributor"/>

        <lang.elementManipulator
                forClass="com.lsfusion.lang.psi.references.LSFJavaClassStringReference"
                implementationClass="com.lsfusion.lang.psi.references.impl.LSFJavaClassStringReferenceManipulator"/>

        <checkinHandlerFactory implementation="com.lsfusion.LSFCheckInHandlerFactory"/>

        <fileDocumentSynchronizationVetoer implementation="com.lsfusion.JarDocumentSavingVetoer"/>

        <toolWindow id="Form Design" factoryClass="com.lsfusion.design.DesignViewToolWindowFactory"
                    anchor="right" icon="AllIcons.FileTypes.UiForm"/>

        <toolWindow id="LSF Module DEPs" anchor="right" icon="AllIcons.Nodes.Deploy"
                    factoryClass="com.lsfusion.dependencies.module.ModuleDependenciesViewToolWindowFactory"/>

        <toolWindow id="LSF Property DEPs" anchor="right" icon="AllIcons.Nodes.Deploy"
                    factoryClass="com.lsfusion.dependencies.property.PropertyDependenciesViewToolWindowFactory"/>
        <codeInsight.lineMarkerProvider language="Lsf"
                                        implementationClass="com.lsfusion.dependencies.property.PropertyComplexityLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="Lsf"
                                        implementationClass="com.lsfusion.dependencies.property.PropertyTableLineMarkerProvider"/>

        <!-- debugger -->
        <xdebugger.breakpointType implementation="com.lsfusion.debug.LSFBreakpointType" />
        <xdebugger.breakpointType implementation="com.lsfusion.debug.property.LSFPropertyBreakpointType" />
        <xdebugger.breakpointType implementation="com.lsfusion.debug.classchange.LSFClassChangeBreakpointType"/>
        <!-- приоритет обратен порядку, поэтому ставим последним -->
        <debugger.positionManagerFactory id="lsfPositionManagerFactory" order="last" implementation="com.lsfusion.debug.LSFPositionManagerFactory"/>
        
        <programRunner implementation="com.lsfusion.debug.LSFDebuggerRunner" />
        <debugger.codeFragmentFactory implementation="com.lsfusion.debug.evaluation.LSFCodeFragmentFactory"/>

        <!-- reports related stuff -->
        <fileTypeFactory implementation="com.lsfusion.reports.JrxmlFileTypeFactory"/>
        <codeInsight.lineMarkerProvider language="Lsf"
                                        implementationClass="com.lsfusion.reports.JrxmlLinkLineMarkerProvider"/>

        <!-- migration -->
        <fileTypeFactory implementation="com.lsfusion.migration.lang.MigrationFileTypeFactory"/>
        <lang.parserDefinition language="LsfMigration"
                               implementationClass="com.lsfusion.migration.lang.MigrationParserDefinition"/>

        <lang.syntaxHighlighterFactory language="LsfMigration"
                                       implementationClass="com.lsfusion.migration.lang.highlight.MigrationSyntaxHighlighterFactory"/>
        <lang.braceMatcher language="LsfMigration"
                           implementationClass="com.lsfusion.migration.lang.MigrationBraceMatcher"/>
        <lang.commenter language="LsfMigration" implementationClass="com.lsfusion.migration.lang.MigrationCommenter"/>
        <lang.foldingBuilder language="LsfMigration"
                             implementationClass="com.lsfusion.migration.lang.folding.MigrationFoldingBuilder"/>
        <fileDocumentManagerListener implementation="com.lsfusion.lang.meta.StripLinesDisabler"/>

        <!--пробуем убрать этот хак, т.к. в данный момент визуально из-за него больше проблем (stepping в ultimate, ...), но надо понаблюдать-->
        <!--<xdebugger.debuggerSupport implementation="com.lsfusion.debug.LSFDumbDebuggerSupport" order="first"/>-->
    </extensions>
</idea-plugin>